KISSY.add("brix/gallery/dialog/index",function(e,t,i){function a(){var t=this;a.superclass.constructor.apply(this,arguments);var t=this,i=e.one(t.get("trigger"));if(i){var n=t.get("triggerType");e.each(n,function(e){i.on(e,t.toggle,t)})}}return a.ATTRS={trigger:{value:!1},triggerType:{value:["click"]},start:{},end:{},elCls:{value:"dialog"},prefixCls:{value:"dialog-"},x:{getter:function(){var e=this;return e.get("start")?e.get("start").left:!1}},y:{getter:function(){var e=this;return e.get("start")?e.get("start").top:!1}},dir:{getter:function(){var e=this,t="",i=e.get("start"),a=e.get("end");return i.left===a.left&&i.top===a.top?!1:t=i.left===a.left&&(i.top<a.top?"down":"up")||i.top===a.top&&(i.left<a.left?"right":"left")||"left"}},duration:{value:.3},easing:{value:"easeNone"},closable:{value:!0},mask:{value:!1},tmpl:{value:null},data:{}},e.extend(a,i,{initializer:function(){var e=this;e.on("afterRenderUI",function(){if(e.get("closable")){var i=e.get("el").one(".dialog-ext-close");i.one(".dialog-ext-close-x").html("&#223"),i.on("mouseenter",function(){i.one(".dialog-ext-close-x").html("&#378")}),i.on("mouseleave",function(){i.one(".dialog-ext-close-x").html("&#223")})}e.get("tmpl")&&(e.pagelet=new t({container:e.get("contentEl"),tmpl:e.get("tmpl"),data:e.get("data")}))})},_visibilityChange:function(t,i){var a=this,n=a.get("el"),r=e.one("body"),o=e.one("html"),s="start";a.get("dir"),n.stop(),r.css({width:r.width(),height:r.height(),overflow:"hidden"}),o.css({width:r.width(),height:r.height(),overflow:"hidden"}),n.css("visibility","visible"),t?(n.css(a.get("start")),s="end"):(n.css(a.get("end")),s="start"),n.animate(a.get(s),a.get("duration"),a.get("easing"),function(){n.css("visibility",t?"visible":"hidden"),t||n.css({left:"-99999px",top:"-99999px"}),r.css({width:"",height:"",overflow:""}),o.css({width:"",height:"",overflow:""}),i&&i.call(a)})},bindUI:function(){var e=this,t=e.get("el");e.on("beforeVisibleChange",function(i){if(!e.get("start"))return!0;var a=i.newVal,n=e.get("dir");return t.removeClass("dialog-left").removeClass("dialog-right").removeClass("dialog-up").removeClass("dialog-down"),n&&t.addClass("dialog-"+n),a?void 0:(e._visibilityChange(a,function(){t.css("visibility","hidden"),e.set("visible",!1,{silent:!0}),e.fire("hide")}),!1)}),e.on("afterVisibleChange",function(t){if(!e.get("start"))return!0;var i=t.newVal;i&&e._visibilityChange(i)})},destructor:function(){var t=this,i=e.one(t.get("trigger"));if(i){var a=t.get("triggerType");e.each(a,function(e){i.detach(e,t.toggle,t)})}t.pagelet&&(t.pagelet.destroy(),t.pagelet=null)},toggle:function(e){var t=this;e&&e.preventDefault();var t=this,i=t.get("el");i?"hidden"==i.css("visibility")?t.show():t.hide():t.show()}}),a},{requires:["brix/core/pagelet","overlay"]});