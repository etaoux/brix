KISSY.add("brix/gallery/sidenav/index",function(a,b){var c=a.all,d=function(){d.superclass.constructor.apply(this,arguments)};return d.ATTRS={index:{value:"#!/home/"},duration:{value:.25},pathMap:{value:{"#!/adzone/adzone_detail/":"#!/adzone/adzone/","#!/plan/handle/":"#!/plan/list/","#!/plan/price_handle/":"#!/plan/list/","#!/messages/list/":"","#!/messages/detail/":"","#!/components/":""}}},a.extend(d,b,{initialize:function(){this.sidebar=a.one("#sidebar"),this.main=a.one("#inmain"),this.allLinks=this.sidebar.all("a"),this.nav=a.one("#nav"),this.subNav=a.one("#subNav"),this.subNavWrap=a.one("#subNavWrap"),this.subNavHandle=a.one("#subNavHandle"),this.pathMap=this.get("pathMap"),this.subNavView=a.one('<div class="sub-nav-view"></div>').appendTo("body"),this.localStorage=window.localStorage,this.isFullSubNav=this.localStorage&&this.localStorage.isFullSubNav||"1",this.isFullSubNav==="0"&&this.subNavHandle.replaceClass("icon-expand","icon-collapse"),this.index=this.get("index"),this.duration=this.get("duration"),this.isHandleClick=!1,this.navTop=this.nav.offset().top,this._bindUI(),this._pathname2sidebar()},clickSwitch:function(b){a.one(b).fire("click")},_getPathname:function(){var a,b=/^#!(\/.+)\/.*$/.exec(location.hash);return a=b&&b[1]||"",a},_pathname2sidebar:function(){var b=this._getPathname(),c=b&&"#!"+b+"/"||this.index;a.each(this.pathMap,function(a,b){if(c===b)return c=a,!1});if(c===""){this._setNoSelectedNav();return}this.sidebar.all("a").each(function(a){var b=a.attr("href"),d=b.match(/.*\//);if(!d)return!1;var e=d[0];if(e.slice(e.indexOf("#"))===c)return a.fire("click"),!1}),this.isNavClick=!1},_setNoSelectedNav:function(){this.sidebar.all("a").removeClass("on"),this._collapseNav()},_bindUI:function(){var b=this;c(window).on("scroll",function(a){b._timer(function(){b._fixedStatic()},10)}).on("hashchange",function(){b.isNavClick||b._pathname2sidebar(),b.isNavClick=!1}),b.nav.delegate("click","a",function(d){var e=a.one(d.target);b.isHandleClick=!1,b._expandCollapseNav(e),b.nowNav=e,b.isNavClick=!0,c(window).scrollTop(0)}),b.subNav.delegate("click","a",function(d){var e=a.one(d.target).closest("a"),f=e.closest(".sub-nav-ul"),g=f.attr("data-sub");b.isHandleClick=!1,b.nowNav=b.nav.all("a[data-sub="+g+"]"),b.nowNav.fire("click"),b.currentSubNav=e.closest(".sub"),b._setSubNavOn(e),b.isNavClick=!0,c(window).scrollTop(0)}),b.subNav.delegate("click",".sub-title",function(a){var d=c(a.currentTarget),e=d.next(".sub-nav-third");if(e.css("height")==="0px"){var f=e.css("height","auto").height();e.css("height",0),e.animate({height:f},b.duration,"easeOut")}else e.animate({height:0},b.duration,"easeOut")}),b.subNavHandle.on("click",function(){b.isHandleClick=!0,b._expandCollapseSubNav()}),b.subNav.delegate("mouseenter",".sub",function(c){if(b.isFullSubNav!=="0")return;var d=a.one(c.target).closest(".sub"),e=d.offset();b.currentLi=d,b.subNavView.html(d.html()),b.subNavView.one(".sub-nav-third").css("height","auto"),b.subNavView.css(e)}),b.subNavView.on("mouseleave",function(a){b.subNavView.css("left","-10000px"),b.subNavView.one(".sub-nav-third").css("height",0),b.currentLi.html(b.subNavView.html())}),b.subNavView.delegate("click","a",function(c){var d=a.one(c.target).closest("a");b._setSubNavOn(d),b.currentSubNav=b.currentLi,b.isNavClick=!0})},_fixedStatic:function(){var b=this,c=Math.max(document.body.scrollTop,document.documentElement.scrollTop),d=c>b.navTop;d?(b.sidebar.addClass("sidebar-fixed"),a.UA.ie===6&&b.sidebar.css({position:"absolute",top:c+10})):(b.sidebar.removeClass("sidebar-fixed"),a.UA.ie===6&&b.sidebar.css({position:"static"}))},_timer:function(a,b){clearTimeout(this.itv),this.itv=setTimeout(a,b)},_setSubNavOn:function(a){var b=a.closest(".sub-nav-third");this.subNav.all("a, .icon-font").removeClass("on"),this.subNavView.all("a, .icon-font").removeClass("on"),a.addClass("on"),this.isFullSubNav==="0"&&b&&b.prev().addClass("on")},_expandCollapseNav:function(a){var b=this,c=a.attr("data-sub"),d=a.attr("href"),e;d=d.slice(d.indexOf("#"));if(c){b.currentNav&&b.currentNav.hide(),b.currentNav=b.subNav.one('[data-sub="'+c+'"]'),b.currentNav.all("a").each(function(a){var b=a.attr("href");if(b.slice(b.indexOf("#"))===d)return e=a,!1});if(!e)return;b.currentSubNav=e,b._setSubNavOn(e),b.currentNav.show(),b._expandNav()}else b._collapseNav();b.nav.all("a").removeClass("on"),a.addClass("on")},_switchTrigger:function(){this.isFullSubNav==="1"?this.subNavHandle.replaceClass("icon-collapse","icon-expand"):this.isFullSubNav==="0"&&this.subNavHandle.replaceClass("icon-expand","icon-collapse")},_expandCollapseSubNav:function(){function e(){var a=this.isFullSubNav==="1";this.isFullSubNav=a?"0":"1",this.localStorage&&(this.localStorage.isFullSubNav=a?"0":"1")}var a=this,b=a.currentSubNav,c=b&&(b.prop("nodeName")==="LI"?b.one("ul"):b.closest("ul")),d=c&&c.hasClass("sub-nav-third");a.isFullSubNav==="0"?(e.call(a),a._expandSubNav(),a._switchTrigger(),d&&c.prev()&&c.prev().removeClass("on")):a.isFullSubNav==="1"&&(a._collapseSubNav(function(){e.call(a),a._switchTrigger()}),d&&c.prev()&&c.prev().addClass("on"))},_collapseSubNav:function(a){this.subNav.animate({width:"16px","padding-top":"42px"},this.duration,"easeOut",a),this.main.animate({"margin-left":"116px"},this.duration,"easeOut"),this._collapseThirdNav()},_expandSubNav:function(a){this.subNav.animate({width:"140px","padding-top":"0px"},this.duration,"easeOut",a),this.main.animate({"margin-left":"240px"},this.duration,"easeOut"),this._expandThirdNav(),this.subNavView.css("left","-10000px")},_expandThirdNav:function(b){var c=this;if(!c.nowNav)return;c.nowNav.attr("data-sub")===c.currentNav.attr("data-sub")&&!c.isHandleClick?a.all(".sub-nav-third").css("height","auto"):a.all(".sub-nav-third").each(function(a,d){var e=a.css("height","auto").height();a.css("height",0),a.animate({height:e},c.duration,"easeOut",b)})},_collapseThirdNav:function(b){a.all(".sub-nav-third").animate({height:0},this.duration,"easeOut",b)},_expandNav:function(a){this.subNav.show(),this.subNav.animate({width:this.isFullSubNav==="1"?"140px":"16px","padding-top":this.isFullSubNav==="1"?"0":"42px"},this.duration,"easeOut",a),this.subNavWrap.animate({"margin-left":"0"},this.duration,"easeOut",a),this.main.animate({"margin-left":this.isFullSubNav==="1"?"240px":"116px"},this.duration,"easeOut"),this.isFullSubNav==="1"?this._expandThirdNav():this._collapseThirdNav()},_collapseNav:function(a){var b=this;this.subNav.animate({width:"1px"},this.duration,"easeOut",function(){b.subNav.hide()}),this.subNavWrap.animate({"margin-left":this.isFullSubNav==="1"?"-140px":"-16px"},this.duration,"easeOut",a),this.main.animate({"margin-left":"100px"},this.duration,"easeOut")}}),d},{requires:["brix/core/brick"]});