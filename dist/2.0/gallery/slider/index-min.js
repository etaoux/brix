KISSY.add("brix/gallery/slider/index",function(e,t,i,a,n){function r(){r.superclass.constructor.apply(this,arguments)}r.FIRES={drag:"drag",dragstart:"dragstart",dragend:"dragend",resize:"resize"};var s={horizontal:"horizontal",vertical:"vertical"};return r.ATTRS={range:{value:!1},mode:{value:"horizontal"},startStep:{value:0},endStep:{value:100},integerStep:{value:1},current:{},knobOffset:{value:-7}},r.METHODS={resize:function(){this.fire(r.FIRES.resize)},destructor:function(){this.knob.destroy(),this.knob_start&&this.knob_start.destroy(),this.knobNode=null,this.knobNode_start=null}},e.extend(r,t,{initialize:function(){this._render_range(),this._render_knob()},_render_knob:function(){function t(){var t=d.value,a=S?u.height():u.width();e.isArray(t)?(t[0]=i(t[0],f,h),t[1]=i(t[1],f,h),x=a*(t[1]-f)/(h-f),y=a*(t[0]-f)/(h-f),m.css(T,x),b.css(T,y),v.css(T,y),v.css(_,Math.abs(x-y)),y==a?b.css("zIndex",2):b.css("zIndex","auto")):(t=i(t,f,h),x=a*(t-f)/(h-f),v.css(_,Math.abs(x)),m.css(T,x))}function i(t,i,a){return e.isUndefined(t)&&(t=i),i>t&&a>t&&(t=i),t>a&&t>i&&(t=a),t}function a(){var t=S?u.height():u.width(),i=(h-f)*x/t+f,a=null===y?null:(h-f)*y/t+f;g&&(i=Math.round(i/g)*g,a=null===a?null:Math.round(a/g)*g),e.log("("+h+"-"+f+")*"+x+"/"+t+"+"+f),d.value=b?[a,i]:i,o(d.value),d.fire(r.FIRES.drag,{data:d.value,current:d.get("current")}),e.log("Slider: change="+d.value+","+d.get("current"))}function o(t){var i,a=d.get("range");e.isArray(t)&&(h>f&&t[0]>t[1]&&(t=[t[1],t[0]]),f>h&&t[0]<t[1]&&(t=[t[1],t[0]])),i=t,e.isArray(d.get("range"))&&(i=e.isArray(t)?[a[t[0]],a[t[1]]]:a[t]),d.set("current",i)}function l(){d.fire(r.FIRES.dragstart,{data:d.value,current:d.get("current")})}function c(){t(),d.fire(r.FIRES.dragend,{data:d.value,current:d.get("current")})}var d=this,u=d.get("el"),p=d.get("mode"),f=d.get("startStep"),h=d.get("endStep"),g=d.get("integerStep"),v=u.one(".slider-bar"),m=u.one(".slider-knob-end"),b=this.knobNode_start=u.one(".slider-knob-start"),x=0,y=null,w=d.get("knobOffset"),S=p===s.horizontal?!1:!0,k=S?"top":"left",T=S?"bottom":"left",_=S?"height":"width";m=m||u.one(".slider-knob"),this.knobNode=m;var C=d.knob=new n.Draggable({node:m,cursor:"move"});if(C.on("drag",function(e){var t=u.offset(),n=S?u.height():u.width(),r=x=e[k]-t[k]-w;S&&(x=n-r),x=i(x,y||0,n),v.css(_,Math.abs(x-(y||0))),v.css(T,y||0),m.css(T,x),a({target:m})}),C.on("dragstart",l),C.on("dragend",c),b){var E=d.knob_start=new n.Draggable({node:b,cursor:"move"});E.on("drag",function(e){var t=u.offset(),n=S?u.height():u.width(),r=y=e[k]-t[k]-w;S&&(y=n-r),y=i(y,0,x),v.css(T,y),v.css(_,Math.abs(x-y)),b.css(T,y),a({target:b})}),E.on("dragstart",l),E.on("dragend",c)}e.isUndefined(d.get("current"))||(d.value=d.value||d.get("current"),t()),d.on(r.FIRES.resize,t)},_render_range:function(){e.isArray(this.get("range"))&&(this.set("endStep",this.get("range").length-1),e.log("slider: range "+this.get("range")),e.isString(this.get("current"))&&(this.value=e.indexOf(this.get("current"),this.get("range"))))}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","ua","node","dd"]});