KISSY.add("brix/gallery/calendar/index",function(e,t,i,n,a){function r(){r.superclass.constructor.apply(this,arguments);var t=this,i=t.get("popup"),n=e.one(t.get("trigger"));if(i&&n){var a=t.get("triggerType");e.each(a,function(e){n.on(e,t.toggle,t)})}}var o='<div class="calendar-pages"></div><div bx-tmpl="calendar" bx-datakey="notLimited,multiSelect,showTime,op_html" class="calendar-operator"> {{{op_html}}}</div>';return r.Date=a,r.ATTRS={date:{value:new Date,setter:function(e){return e||(e=new Date),e}},selected:{value:null},startDay:{value:0},pages:{value:1},closable:{value:!1},rangeSelect:{value:!1},minDate:{value:!1},maxDate:{value:!1},multiSelect:{value:!1},multi:{value:null,setter:function(e){for(var t=0;e.length>t;t++)e[t]instanceof Date&&(e[t]=a.format(e[t],"isoDate"));return e}},navigator:{value:!0},popup:{value:!0},showTime:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},disabled:{value:!1},range:{value:!1},rangeLinkage:{value:!0},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},tmpl:{getter:function(e){if(!e){var t=this;e=o,t.get("el")||(e='<div class="calendar">'+e+"</div>")}return e}},autoRender:{value:!1},zIndex:{value:9999}},r.FIRES={select:"select",monthChange:"monthChange",timeSelect:"timeSelect",rangeSelect:"rangeSelect",multiSelect:"multiSelect",show:"show",hide:"hide"},r.RENDERERS={op:{html:function(e){var t=e,i=t.get("notLimited"),n=t.get("showTime"),a=t.get("multiSelect"),r="";return(n||a)&&(r+='<a class="btn btn-size25 btn-calendar-confirm">\u786e\u5b9a</a>'),i&&(r+='<a class="btn btn-size25 btn-calendar-notlimited">\u4e0d\u9650</a>'),r}}},r.DOCEVENTS={"":{click:function(t){var i=this,n=i.get("el"),a=e.one(t.target),r=e.one(i.get("trigger"));n.equals(a)||n.contains(a)||!r||r.contains(a)||a[0]==r[0]||i.hide()}}},r.EVENTS={".btn-calendar-confirm":{click:function(){var t=this,i=t.get("selected"),n=t.get("showTime"),o=t.get("multiSelect");if(o){var s=e.clone(t.get("multi"));s.sort(function(e,t){return e>t?1:-1});for(var l=0;s.length>l;l++)s[l]=a.parse(s[l]);e.log(s),t.fire(r.FIRES.multiSelect,{multi:s})}else if(n){var c=new Date;i&&(c=i);var d=t.pageBricks[0].timeBrick.get("time");c.setHours(d.getHours()),c.setMinutes(d.getMinutes()),c.setSeconds(d.getSeconds()),e.log(c),t.fire(r.FIRES.timeSelect,{date:c})}t.hide()}},".btn-calendar-notlimited":{click:function(){var e=this,t=e.get("notLimited");t&&(e.fire(r.FIRES.select,{date:null}),e.hide())}}},r.METHODS={show:function(){var t=this;if(t.get("rendered")||t.render(),t.overlay){var i=e.clone(t.get("align"));i.node||(i.node=t.get("trigger")),t.overlay.set("align",i),t.overlay.show(),t.fire(r.FIRES.show)}},hide:function(){var e=this;e.overlay&&(e.overlay.hide(),e.fire(r.FIRES.hide))},toggle:function(e){var t=this;e&&e.preventDefault();var t=this;t.overlay?"hidden"==t.overlay.get("el").css("visibility")?t.show():t.hide():t.show()}},e.extend(r,t,{initialize:function(){var t=this,a=t.get("popup"),o=t.get("closable"),s=t.get("pages"),l=t.get("rangeLinkage"),c=t.get("el"),d=t.get("date"),u=d.getMonth(),p=d.getFullYear(),f=t.get("trigger");if(a){var h=e.clone(t.get("align"));h.node||(h.node=f),t.overlay=new i({srcNode:t.get("el"),align:h,zIndex:t.get("zIndex")}),t.overlay.render()}else c.css({position:"static",visibility:"visible"});var g=c.one(".calendar-pages");t.pageBricks=[],c.addClass(".calendar-"+s);for(var m,v,b=0;s>b;b++)l?(m=0==b,v=b==s-1):(m=!0,v=!0),function(e){var i=new n({index:e,prev:m,next:v,year:p,month:u,father:t,destroyAction:t.get("destroyAction"),container:g});t.pageBricks.push(i),i.on("itemClick",function(e){var i=t.get("rangeSelect");i?t._handleRange(e.date):e.date&&(t.set("selected",e.date),t.fire(r.FIRES.select,{date:e.date}),a&&o&&!t.get("showTime")&&t.hide())}),i.on("itemMouseDown",function(e){var i=t.get("multiSelect");i&&t._handleMultiSelectStart(e.date)}),i.on("itemMouseUp",function(e){var i=t.get("multiSelect");i&&t._handleMultiSelectEnd(e.date)}),i.on("monthChange",function(e){t._bindDateValueChange(e.date,e.index)})}(b),11==u?(p++,u=0):u++;t._bindDataChange("range"),t._bindDataChange("multi"),t._bindDataChange("disabled"),t._bindDataChange("minDate"),t._bindDataChange("maxDate"),t._bindDataChange("selected"),t._bindDataChange("startDay"),t.on("afterDateChange",function(){t._bindDateValueChange(t.get("date"))})},destructor:function(){var t=this,i=e.one(t.get("trigger"));if(t.get("popup")&&i){var n=t.get("triggerType");e.each(n,function(e){i.detach(e,t.toggle,t)})}t.pageBricks&&(e.each(t.pageBricks,function(e){e.destroy()}),t.pageBricks=null),t.overlay&&t.overlay.destroy()},_bindDataChange:function(e,t){var i=this,t=e.replace(/\b(\w)|\s(\w)/g,function(e){return e.toUpperCase()});i.on("after"+t+"Change",function(){for(var t=i.get(e),n=0;i.pageBricks.length>n;n++)i.pageBricks[n].setChunkData(e,t)})},_bindDateValueChange:function(e,t){t=t||0;var i=this,n=i.get("rangeLinkage"),a=e.getFullYear(),o=e.getMonth();if(n){for(var s=0;i.pageBricks.length>s;s++){var l=o-t+s,c=a;0>l?(c--,l+=12):l>11&&(c++,l-=12),i.pageBricks[s].set("year",c),i.pageBricks[s].set("month",l)}var d=a,u=o-t;0>u&&(d--,u+=12),i.fire(r.FIRES.monthChange,{date:new Date(d,u,1)})}else i.pageBricks[t].set("year",a),i.pageBricks[t].set("month",o),i.fire(r.FIRES.monthChange,{date:new Date(a,o,1)})},_handleRange:function(t){var i,n=this,a=e.clone(n.get("range"))||{};if(!a.start&&!a.end||a.start&&a.end)a.start=t,a.end=null,n.set("range",a);else{a.end=t,a.start.getTime()>a.end.getTime()&&(i=a.start,a.start=a.end,a.end=i),n.set("range",a),n.fire(r.FIRES.rangeSelect,a);var o=n.get("popup"),s=n.get("closable");o&&s&&n.hide()}},_handleMultiSelectStart:function(e){this.multiStartDate=e},_handleMultiSelectEnd:function(t){if(this.multiStartDate){var i,n=this,r=e.clone(n.get("multi"))||[],o=n.multiStartDate,s=(n.get("minDate"),n.get("maxDate"),n.get("disabled"));for(o>t?(i=o,o=t):i=t;i>=o;)if(!a.isDisabled(s,o)){var l=a.format(o,"isoDate");e.inArray(l,r)?r.splice(e.indexOf(l,r),1):r.push(l),o.setDate(o.getDate()+1)}delete n.multiStartDate,n.set("multi",r)}}}),e.augment(r,r.METHODS),r},{requires:["brix/core/brick","overlay","./page","./date"]}),KISSY.add("brix/gallery/calendar/date",function(){function e(e,t){var i=null;if(t=t||"-",e instanceof Date)return e;if(i=new Date(e),i instanceof Date&&"Invalid Date"!=i&&!isNaN(i))return i;var n=(""+e).split(t);return 3==n.length&&(i=new Date(n[0],parseInt(n[1],10)-1,n[2]),i instanceof Date&&"Invalid Date"!=i&&!isNaN(i))?i:null}var t=function(){var t=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,a=function(e,t){for(e+="",t=t||2;t>e.length;)e="0"+e;return e},r={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},o={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(s,l,c){if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(l=s,s=void 0),s=s?e(s):new Date,isNaN(s))throw SyntaxError("invalid date");l=(r[l]||l||r["default"])+"","UTC:"==l.slice(0,4)&&(l=l.slice(4),c=!0);var d=c?"getUTC":"get",u=s[d+"Date"](),p=s[d+"Day"](),f=s[d+"Month"](),h=s[d+"FullYear"](),g=s[d+"Hours"](),m=s[d+"Minutes"](),v=s[d+"Seconds"](),b=s[d+"Milliseconds"](),x=c?0:s.getTimezoneOffset(),y={d:u,dd:a(u,void 0),ddd:o.dayNames[p],dddd:o.dayNames[p+7],w:o.dayNames[p+14],m:f+1,mm:a(f+1,void 0),mmm:o.monthNames[f],mmmm:o.monthNames[f+12],yy:(h+"").slice(2),yyyy:h,h:g%12||12,hh:a(g%12||12,void 0),H:g,HH:a(g,void 0),M:m,MM:a(m,void 0),s:v,ss:a(v,void 0),l:a(b,3),L:a(b>99?Math.round(b/10):b,void 0),t:12>g?"a":"p",tt:12>g?"am":"pm",T:12>g?"A":"P",TT:12>g?"AM":"PM",Z:c?"UTC":((s+"").match(i)||[""]).pop().replace(n,""),o:(x>0?"-":"+")+a(100*Math.floor(Math.abs(x)/60)+Math.abs(x)%60,4),S:["th","st","nd","rd"][u%10>3?0:(10!=u%100-u%10)*u%10]};return l.replace(t,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();return{format:function(e,i,n){return t(e,i,n)},parse:function(t,i){return e(t,i)},isMinMax:function(e,i,n){return n=t(n,"isoDate"),e&&(e=Brix_Date.format(e,"isoDate"),e>n)?!1:i&&(i=Brix_Date.format(i,"isoDate"),n>i)?!1:!0},isDisabled:function(e,i){if(i=t(i,"isoDate"),e)for(var n=0;e.length>n;n++)if(t(e[n],"isoDate")==i)return!0;return!1},isInMulit:function(e,i){if(i=t(i,"isoDate"),e)for(var n=0;e.length>n;n++)if(t(e[n],"isoDate")==i)return!0;return!1},isInRang:function(e,i){if(i=t(i,"isoDate"),e)if(e.start&&e.end){if(i>=t(e.start,"isoDate")&&t(e.end,"isoDate")>=i)return!0}else if(e.start&&i==t(e.start,"isoDate"))return!0;return!1},isYear:function(e){return/^\d+$/i.test(e)?(e=Number(e),!(100>e||e>1e4)):!1}}}),KISSY.add("brix/gallery/calendar/page",function(e,t,i,n){function a(e){for(var t=[],i=0;7>i;i++)t[i]=l[(i+e)%7];return t}function r(e,t){return 32-new Date(e,t,32).getDate()}function o(){o.superclass.constructor.apply(this,arguments)}var s='<div class="calendar-page"><div class="calendar-page-hd"><div bx-mpl="page" bx-datakey="prev"> {{#prev}} <a href="javascript:void(0);" class="calendar-prev-year"><i class="iconfont">&#403</i><i class="iconfont icon-yp">&#403</i></a><a href="javascript:void(0);" class="calendar-prev-month"><i class="iconfont">&#403</i></a> {{/prev}} </div><a bx-tmpl="yearmonth" bx-datakey="year,month" href="javascript:void(0);" class="calendar-year-month"> {{year}}\u5e74{{month}}\u6708 </a><div bx-tmpl="next" bx-datakey="next"> {{#next}} <a href="javascript:void(0);" class="calendar-next-month "><i class="iconfont">&#402</i></a><a href="javascript:void(0);" class="calendar-next-year "><i class="iconfont icon-yn">&#402</i><i class="iconfont">&#402</i></a> {{/next}} </div><div class="calendar-year-month-pupop" ><p bx-tmpl="select" bx-datakey="month,select_html">{{{select_html}}}</p><p bx-tmpl="year" bx-datakey="year">\u5e74:<input type="text" value="{{year}}" onfocus="this.select()"></p><p><a class="btn btn-size25 btn-pupop-confirm">\u786e\u5b9a</a><a class="btn-pupop-cancel" href="#">\u53d6\u6d88</a></p></div></div><div bx-tmpl="pagewbd" bx-datakey="startDay,days_html" class="calendar-page-wbd"> {{{days_html}}} </div><div bx-tmpl="pagedbd" bx-datakey="startDay,year,month,selected,range,multi,disabled,minDate,maxDate,da_html" class="calendar-page-dbd"> {{{da_html}}} </div><div class="calendar-page-fd"></div></div>',l=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];return o.ATTRS={father:{value:!1},index:{value:0},year:{value:2012},month:{value:7},prev:{value:!0},next:{value:!0},autoRender:{value:!0},tmpl:{value:s},data:{valueFn:function(){var e=this,t=(e.get("father"),e.get("year")),i=e.get("month"),n=e.get("prev"),a=e.get("next");return{prev:n,next:a,month:i+1,year:t}}}},o.RENDERERS={da:{html:function(e){var t=e,i=t.get("father"),a=t.get("year"),o=t.get("month"),s=i.get("selected"),l=i.get("minDate"),c=i.get("maxDate"),d=i.get("disabled"),u=i.get("multi"),p=i.get("range"),f=(7-i.get("startDay")+new Date(a,o,1).getDay())%7,h=r(a,o),g=n.format(new Date,"isoDate"),m="";s&&(s=n.format(s,"isoDate")),l&&(l=n.format(l,"isoDate")),c&&(c=n.format(c,"isoDate"));for(var v=0;f>v;v++)m+='<a href="javascript:void(0);" class="calendar-hidden">0</a>';for(var v=1;h>=v;v++){var b='class="calendar-item',x=n.format(new Date(a,o,v),"isoDate");l>x||x>c||n.isDisabled(d,x)?b+=" calendar-disabled":n.isInRang(p,x)?b+=" calendar-range":s==x?b+=" calendar-selected":n.isInMulit(u,x)&&(b+=" calendar-multi"),g==x&&(b+=" calendar-today"),m+="<a "+b+'" href="javascript:void(0);">'+v+"</a>"}return m}},select:{html:function(){for(var e="\u6708:<select>",t=1;12>=t;t++)e+="<option"+(t==this.month?" selected":"")+' value="'+(t-1)+'">'+(10>t?"0"+t:t)+"</option>";return e+="</select>"}},days:{html:function(t){var i=t.get("father"),n=a(i.get("startDay")),r="";return e.each(n,function(e){r+="<span>"+e+"</span>"}),r}}},o.EVENTS={".calendar-prev-year":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),n=e.get("index");t--,date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:n})}},".calendar-prev-month":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),n=e.get("index");i--,0>i&&(t--,i+=12),date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:n})}},".calendar-next-year":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),n=e.get("index");t++,date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:n})}},".calendar-next-month":{click:function(){var e=this,t=e.get("year"),i=e.get("month"),n=e.get("index");i++,i>11&&(t++,i-=12),date=new Date(t,i,1),e.fire(o.FIRES.monthChange,{date:date,index:n})}},".calendar-year-month":{click:function(){var e=this,t=e.get("father").get("navigator");t&&(popupNode=e.get("el").one(".calendar-year-month-pupop").show())}},".btn-pupop-confirm":{click:function(e){e.preventDefault();var t=this,i=t.get("index");if(popupNode=t.get("el").one(".calendar-year-month-pupop"),year=popupNode.one("input").val(),month=popupNode.one("select").val(),n.isYear(year)){year=Number(year),month=Number(month);var a=new Date(year,month,1);popupNode.hide(),t.fire(o.FIRES.monthChange,{date:a,index:i})}}},".btn-pupop-cancel":{click:function(e){e.preventDefault();var t=this,i=t.get("el").one(".calendar-year-month-pupop");i.hide()}},".calendar-item":{click:function(t){t.preventDefault();var i=this,n=e.one(t.currentTarget);if(!n.hasClass("calendar-disabled")){var a=!1,r=i.get("year"),s=i.get("month");if(a=new Date(r,s,Number(n.html())),i.timeBrick){var l=i.timeBrick.get("time");a.setHours(l.getHours()),a.setMinutes(l.getMinutes()),a.setSeconds(l.getSeconds())}e.later(function(){i.fire(o.FIRES.itemClick,{date:a})},0)}},mousedown:function(t){t.preventDefault();var i=this,n=e.one(t.currentTarget);if(!n.hasClass("calendar-disabled")){var a=i.get("year"),r=i.get("month"),s=new Date(a,r,Number(n.html()));i.fire(o.FIRES.itemMouseDown,{date:s})}},mouseup:function(t){t.preventDefault();var i=this,n=e.one(t.currentTarget);if(!n.hasClass("calendar-disabled")){var a=i.get("year"),r=i.get("month"),s=new Date(a,r,Number(n.html()));i.fire(o.FIRES.itemMouseUp,{date:s})}}}},o.METHODS={},o.FIRES={itemClick:"itemClick",itemMouseDown:"itemMouseDown",itemMouseUp:"itemMouseUp",monthChange:"monthChange"},e.extend(o,t,{initialize:function(){var e=this,t=e.get("el"),n=e.get("father"),a=n.get("showTime");a&&(e.timeBrick=new i({destroyAction:e.get("destroyAction"),container:t.one(".calendar-page-fd")})),e.on("afterYearChange",function(){e.setChunkData("year",e.get("year"))}),e.on("afterMonthChange",function(){e.setChunkData("month",e.get("month")+1)})},destructor:function(){var e=this;e.timeBrick&&e.timeBrick.destroy()}}),e.augment(o,o.METHODS),o},{requires:["brix/core/brick","./time","./date"]}),KISSY.add("brix/gallery/calendar/time",function(e,t){var i={h:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],m:["00","10","20","30","40","50"],s:["00","10","20","30","40","50"]},n='<div tabIndex="1"><div class="calendar-time"> \u65f6\u95f4\uff1a<span bx-tmpl="h" bx-datakey="h" class="h">{{h}}</span>:<span bx-tmpl="m" bx-datakey="m" class="m">{{m}}</span>:<span bx-tmpl="s" bx-datakey="s" class="s">{{s}}</span><div class="calendar-time-updown"><i class="iconfont u">&#456</i><i class="iconfont d">&#459</i></div></div><div class="calendar-time-popup"><div bx-tmpl="time" bx-datakey="list" class="calendar-time-popup-bd"> {{#list}} <a class="item">{{.}}</a> {{/list}} </div><i class="iconfont icon-close">&#223</i></div></div>',a=t.extend({_setTime:function(e,t){var i=this,n=i.get("time");switch(i.get("el"),t=Number(t),e){case"h":n.setHours(t);break;case"m":n.setMinutes(t);break;case"s":n.setSeconds(t)}i.setChunkData("h",n.getHours()),i.setChunkData("m",n.getMinutes()),i.setChunkData("s",n.getSeconds())},_getTime:function(e){var t=this,i=t.get("time");switch(e){case"h":return i.getHours();case"m":return i.getMinutes();case"s":return i.getSeconds()}},_hideTimePopup:function(){var e=this,t=e.get("el");t.one(".calendar-time-popup").css({display:"none"})}},{ATTRS:{time:{value:new Date},status:{value:"s"},autoRender:{value:!0},tmpl:{value:n},data:{valueFn:function(){var e=this,t=e.get("time");return{h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()}}}},EVENTS:{span:{click:function(t){var n=this,a=e.one(t.currentTarget);a.parent().all("span").removeClass("on"),a.addClass("on"),a.hasClass("h")?n.set("status","h"):a.hasClass("m")?n.set("status","m"):n.set("status","s");var r=n.get("status");n.setChunkData("list",i[r]),n.get("el").one(".calendar-time-popup").css({display:"block"})}},".icon-close":{click:function(){var e=this;e._hideTimePopup()}},".item":{click:function(t){var i=this,n=e.one(t.currentTarget),a=i.get("status");i._setTime(a,n.html()),i._hideTimePopup()}},".u":{click:function(){var e=this,t=e.get("status"),i=e._getTime(t);i++,e._setTime(t,i)}},".d":{click:function(){var e=this,t=e.get("status"),i=e._getTime(t);i--,e._setTime(t,i)}},"":{keyup:function(e){var t=this,i=t.get("status"),n=t._getTime(i);(38==e.keyCode||37==e.keyCode)&&(e.preventDefault(),n++,t._setTime(i,n)),(40==e.keyCode||39==e.keyCode)&&(e.preventDefault(),n--,t._setTime(i,n))}}},FIRES:{timeSelect:"timeSelect"}},"Time");return a},{requires:["brix/core/brick"]});