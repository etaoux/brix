KISSY.add("brix/gallery/dropdown/index",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}return i.ATTRS={mode:{value:1},autoResize:{value:!0},setDefault:{value:!1}},i.FIRES={beforeFocus:"beforeFocus",focus:"focus",beforeBlur:"beforeBlur",blur:"blur",selected:"selected"},i.METHODS={focus:function(){var e=this.get("mode"),t=this.get("el"),a=t.one(".dropdown-list");if("none"===a.css("display")){if(this.fire(i.FIRES.beforeFocus),1==e&&t.one(".dropdown-hd").addClass("dropdown-hd-active"),a.css({display:"block"}),this.get("autoResize")){var n=t.one(".dropdown-hd").outerWidth();t.one(".dropdown-list").css({width:n+"px"})}this.fire(i.FIRES.focus)}},blur:function(){var e=this.get("mode"),t=this.get("el"),a=t.one(".dropdown-list");"none"!==a.css("display")&&(t.all(".dropdown-item").removeClass(".dropdown-itemover"),this.fire(i.FIRES.beforeBlur),1==e&&t.one(".dropdown-hd").removeClass("dropdown-hd-active"),a.css("display","none"),this.fire(i.FIRES.blur))},select:function(e){var t,i=this,a=this.get("el"),n=a.all(".dropdown-item");if(e===void 0){var r={};return n.each(function(e){if(e.hasClass("dropdown-itemselected")){a.one(".dropdown-text");var t=e.one("span");r={value:t.attr("value")||"",text:t.text()}}}),r}n.each(function(i){var a=i.one("span"),n=a.attr("value")||"";return n==e?(t=i,!1):void 0}),t&&i._select(t)}},i.DOCEVENTS={"":{click:function(e){var t=this,i=t.get("el");t.__show||i.contains(e.target)||(i.all(".dropdown-list").css("display","none"),i.all(".dropdown-hd").removeClass("dropdown-hd-active")),t.__show=!1}}},i.EVENTS={"":{mouseleave:function(){var e=this.get("mode");1!=e&&this.blur()},keydown:function(e){var t=this,i=t.get("el");switch(e.keyCode){case 9:case 27:t.blur();break;case 13:t.__show=!0;var a=i.one(".dropdown-itemover");if(t.blur(),!a||a.hasClass("dropdown-itemselected"))return;t._select(a);break;case 38:e.preventDefault(),t.focus();var n,r=i.one(".dropdown-itemover")||i.one(".dropdown-itemselected")||i.one(".dropdown-item");if(r.prev())n=r.prev();else{var o=i.all(".dropdown-item");n=o.item(o.length-1)}t._hover(n,!0);break;case 40:e.preventDefault(),t.focus();var n,r=i.one(".dropdown-itemover")||i.one(".dropdown-itemselected")||i.one(".dropdown-item");n=r.next()?r.next():i.one(".dropdown-item"),t._hover(n,!0);break;default:var s=e.keyCode;if(s>=48&&57>=s||s>=65&&90>=s){var l=String.fromCharCode(s).toLowerCase();e.preventDefault(),t.focus();var n,r=i.one(".dropdown-itemover")||i.one(".dropdown-itemselected");r&&r.one("span").text().charAt(0).toLowerCase()==l&&(r=r.next(),r&&r.one("span").text().charAt(0).toLowerCase()==l&&(n=r)),n||i.all(".dropdown-item").each(function(e){return!e||e.hasClass(".dropdown-itemover")||e.hasClass(".dropdown-itemselected")||e.one("span").text().charAt(0).toLowerCase()!=l?void 0:(n=e,!1)}),n&&t._hover(n,!0)}}}},".dropdown-hd":{click:function(){var e=this.get("mode");if(1==e){var t=this.get("el").one(".dropdown-list");this.__show=!0,"block"==t.css("display")?this.blur():this.focus()}},mouseenter:function(){var e=this.get("mode");1!=e&&this.focus()}},".dropdown-item":{click:function(t){var i=this;i.__show=!0,i.get("el");var a=e.one(t.currentTarget);i.blur(),a.hasClass("dropdown-itemselected")||i._select(a)},mouseenter:function(t){var i=e.one(t.currentTarget);this._hover(i)},mouseleave:function(t){var i=e.one(t.currentTarget);i.removeClass("dropdown-itemover")}}},e.extend(i,t,{initialize:function(){var e=this,t=this.get("el");if(t.attr("tabindex",0),e.get("setDefault")){var i=t.one(".dropdown-itemselected")||t.one(".dropdown-item");e._select(i,!0)}},_select:function(e,t){var a=this,n=this.get("el");n.all(".dropdown-item").removeClass(".dropdown-itemover").removeClass("dropdown-itemselected"),e.addClass("dropdown-itemselected");var r=n.one(".dropdown-text"),o=e.one("span"),s={value:o.attr("value")||"",text:o.text()},l=n.one("input");l&&l.val(s.value);var c=r.attr("value")||"";c!=s.value&&(r.attr("value",s.value),r.text(s.text),t||a.fire(i.FIRES.selected,s))},_hover:function(e,t){var i=this.get("el");i.all(".dropdown-item").removeClass(".dropdown-itemover"),e.addClass(".dropdown-itemover"),t&&e.scrollIntoView(i.one(".dropdown-list"))}}),e.augment(i,i.METHODS),i},{requires:["brix/core/brick"]});