KISSY.add("brix/gallery/searchbox/index",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}return c.ATTRS={el:{value:"#J_searchbox"},currentCls:{value:"selected"},suggestApi:{value:"data-suggest-api"},curItem:{value:{},getter:function(){return a.one(this.get("el")).one("."+this.get("currentCls"))}},menu:{value:{}},form:{value:{}},suggest:{value:{}}},c.DOCEVENTS={"":{click:function(b){var c=this,d=a.one(b.target);c.get("el").contains(d)||(c.hideTabs(),c.fire("afterBlur"))}}},c.EVENTS={".s-menu":{mouseenter:function(b){b.preventDefault();var c=this,d=a.one(b.currentTarget),e=d.one(".s-menu-list");d.addClass("expand")},mouseleave:function(b){b.preventDefault();var c=this,d=a.one(b.currentTarget),e=d.one(".s-menu-list");d.removeClass("expand")}},".s-menu-list li":{click:function(b){var c=this,d=a.one(b.currentTarget),e=c.get("currentCls");c.fire("beforeTabChange",{eventData:b.currentTarget});if(d.hasClass(e))return;var f=c.get("el").all("li"),g=c.get("el").one(".s-menu-selected span");f.removeClass(e),d.addClass(e),g.html(d.one("a").html()),c.menu.removeClass("expand"),c.ipt.getDOMNode().value!==""&&c._fireEvent(c.form.getDOMNode(),"submit")}},".searchbox-input":{focus:function(b){var c=this,d=b.currentTarget,e=c.get("curItem").attr(c.get("suggestApi"));c.suggestApi&&c.suggestApi!==e&&(c.detach(b.type,arguments.callee),c.suggest.on("beforeStart",function(){return!1}),c.suggest=undefined),e&&(!c.suggestApi||c.suggestApi!==e)&&a.use("suggest",function(){c._initSuggest(d,e)}),c.suggestApi=e,c.showTabs(),c.fire("afterFocus",{eventData:d})}},form:{submit:function(a){var b=this;b.fire("beforeSubmit",{eventData:a.target});var c=b.get("curItem").one("a");if(b.ipt.getDOMNode().value==="")a.halt(!0),b.focusInput();else{var d=c.attr("href"),e=a.target;e.action=d,b._parseAction(e,d)}}}},c.METHODS={showTabs:function(){var a=this;a.form.addClass("s-focus")},hideTabs:function(){var a=this;a.form.removeClass("s-focus")},focusInput:function(){var a=this;a.ipt.getDOMNode().focus()}},c.FIRES={afterLoad:"afterLoad",beforeTabChange:"beforeTabChange",beforeSubmit:"beforeSubmit",afterFocus:"aferFocus",afterBlur:"afterBlur"},a.extend(c,b,{initialize:function(){var a=this;a.menu=a.get("el").one(".s-menu"),a.form=a.get("el").one("form"),a.ipt=a.get("el").one(".searchbox-input"),a.fire("afterLoad")},destructor:function(){},_parseAction:function(b,c){if(c.indexOf("?")!==-1){var d=c.substring(c.indexOf("?")+1,c.length).split("&");for(var e=0,f=d.length;e<f;e++){if(a.trim(d[e])==="")continue;var g=d[e].split("=");this._writeHiddenInput(b,g[0],g[1])}}},_writeHiddenInput:function(b,c,d){var e=b[c];return e?e.value=d:(e=a.DOM.create('<input type="hidden" name="'+c+'" value="'+d+'" />'),b.appendChild(e)),e},_initSuggest:function(b,c){var d=this;d.suggest=new a.Suggest(b,c,{resultFormat:"%result%",offset:0}),d.suggest.on("beforeShow",function(){d._keyword()}),d.suggest.on("itemSelect",function(){var b=a.DOM,c=this.selectedItem,e=b.query("li",this.containers),f=a.get("form",d.get("el"));d._writeHiddenInput(f,"wq",b.attr(c,"key")),d._writeHiddenInput(f,"suggest","0_"+a.indexOf(c,e))}),d.suggest.on("beforeSubmit",function(){if(b.value==="")return!1})},_keyword:function(){var b=a.DOM,c=this,d=c.suggest,e=d.query,f=e.length;a.each(b.query("li",d.content),function(a){var c=b.get(".ks-suggest-key",a),d=b.html(c);d.indexOf(e)===0&&b.html(c,d.substring(0,f)+"<b>"+d.substring(f,d.length)+"</b>")})},_fireEvent:function(a,b){if(document.createEvent){var c=document.createEvent("HTMLEvents");c.initEvent(b,!0,!0),a.dispatchEvent(c)}else if(document.createEventObject){var c=document.createEventObject();a.fireEvent("on"+b,c)}}}),a.augment(c,c.METHODS),c},{requires:["brix/core/brick"]});