KISSY.add("brix/gallery/datepicker/index",function(a,b,c,d){function e(a){var b=864e5,c=new Date,d=c.getTime();return c.setTime(d+b*a),c}function j(){j.superclass.constructor.apply(this,arguments);var b=this,c=a.one(b.get("trigger"));if(c){var d=b.get("triggerType");a.each(d,function(a){c.on(a,function(a){a.preventDefault(),b.toggle()})})}var e=b.get("isCompare");e&&b.on("afterCompareTextChange",function(a){b.setChunkData("compareText",b.get("compareText"))})}var f=new Date,g=e(-1),h={today:{text:"\u4eca\u5929",dateRange:[f,f]},yestoday:{text:"\u6628\u5929",dateRange:[g,g]},days7before:{text:"\u8fc7\u53bb7\u5929",dateRange:[e(-7),g]},days14before:{text:"\u8fc7\u53bb15\u5929",dateRange:[e(-15),g]}},i="\u4e0d\u9650";return j.Date=d.Date,j.ATTRS={trigger:{value:!1},triggerType:{value:["click"]},quickDates:{value:h},dates:{value:{start:null,end:null}},isQuick:{value:!0},isCompare:{value:!1},compareText:{value:"\u8fc7\u53bb7\u5929"},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},notLimited:{value:!1},pages:{value:2},tmpl:{valueFn:function(){var b=this,c=b.get("id")||"brix_datepicker_"+a.guid();return'<div id="'+c+'" bx-name="datepicker" class="datepicker">'+'<div class="datepicker-bd">'+"{{^isCompare}}"+"<label>\u65e5\u671f\u8303\u56f4\uff1a</label>"+'<div class="range">'+'<input value="{{start}}">'+'<span class="input-split">-</span>'+'<input value="{{end}}">'+"</div>"+"{{/isCompare}}"+"{{#isCompare}}"+"<label>\u5f53\u524d\u65e5\u671f\uff1a</label>"+'<div bx-tmpl="datepicker" bx-datakey="compareText" class="range">{{compareText}}'+"</div>"+"<label>\u4e0e\u5176\u4ed6\u65e5\u671f\u6bd4\u8f83\uff1a(\u987b\u540c\u6837\u5929\u6570)</label>"+'<div class="range">'+'<input value="{{start}}">'+'<span class="input-split">-</span>'+'<input value="{{end}}">'+"</div>"+"{{/isCompare}}"+"{{#isQuick}}"+"{{{"+c+"_quick_html}}}"+"{{/isQuick}}"+'<div class="operator">'+'<a class="btn btn-size25 btn-confirm" href="#">\u786e\u5b9a</a><a class="btn-cancel" href="#">\u53d6\u6d88</a>'+"</div>"+"</div>"+"</div>"}},data:{valueFn:function(){var a=this,b=a.get("isQuick"),c=a.get("isCompare"),e=a.get("compareText"),f=a.get("dates"),g=f.start?d.Date.format(f.start,"isoDate"):i,h=f.end?d.Date.format(f.end,"isoDate"):i;return{start:g,end:h,isQuick:b,isCompare:c,compareText:e}}}},j.RENDERER={quick:{html:function(a){var b=a.get("quickDates"),c='<label>\u5feb\u6377\u65e5\u671f:</label><ul class="quick-list">';for(var d in b)c+='<li><a class="quick-item" key="'+d+'" href="#">'+b[d].text+"</a></li>";return c+="</ul>",c}}},j.DOCATTACH={"":{click:function(b){var c=this,d=c.get("el"),e=a.one(b.target),f=a.one(c.get("trigger"));!d.contains(e)&&f&&e[0]!=f[0]&&(!c.calendar||!c.calendar.get("el").contains(e))&&c.hide()}}},j.ATTACH={input:{click:function(b){var c=this,e=a.one(b.currentTarget),f=d.Date.parse(e.val())||new Date,g=d.Date.parse(e.val()),h=a.clone(c.get("align"));h.node=e[0],c.calendar||(c.calendar=new d({date:f,selected:g,popup:!0,closable:!0,notLimited:c.get("notLimited"),pages:c.get("pages"),align:h}),c.calendar.on("select",function(a){var b=c.calendar.get("trigger");a.date?b.val(d.Date.format(a.date,"isoDate")):b.val(i)})),c.calendar.set("date",f),c.calendar.set("selected",g),c.calendar.set("trigger",e),c.calendar.set("align",h),c.calendar.show()}},".btn-confirm":{click:function(b){b.preventDefault();var c=this,e=c.get("el"),f=e.one(".quick-list");dates={isQuick:!1},inputs=e.all("input"),f&&f.all("a").removeClass("quick-current"),dates.start=d.Date.parse(inputs.item(0).val()),dates.end=d.Date.parse(inputs.item(1).val()),a.log(dates),c.fire(j.FIRES.selected,dates),c.hide()}},".btn-cancel":{click:function(a){a.preventDefault(),this.hide()}},".quick-item":{click:function(b){b.preventDefault();var c=this,d=a.one(b.currentTarget),e=c.get("el"),f=c.get("quickDates"),g=a.one(b.currentTarget).attr("key"),h=f[g],i={isQuick:!0};e.one(".quick-list").all("a").removeClass("quick-current"),d.addClass("quick-current"),i.start=h.dateRange[0],i.end=h.dateRange[1],i.quickDate=h,a.log(i),c.fire(j.FIRES.selected,i),c.hide()}}},j.METHOD={show:function(){var b=this;b.get("rendered")||b.render();if(b.overlay){var c=a.clone(b.get("align"));c.node||(c.node=b.get("trigger")),b.overlay.set("align",c),b.overlay.show(),b.fire(j.FIRES.show)}},hide:function(){var a=this;a.overlay&&(a.overlay.hide(),a.fire(j.FIRES.hide))},toggle:function(){var a=this;a.overlay?a.overlay.get("el").css("visibility")=="hidden"?a.show():a.hide():a.show()}},j.FIRES={selected:"selected",show:"show",hide:"hide"},a.extend(j,b,{initialize:function(){var a=this;a.overlay=new c({srcNode:"#"+a.get("id")}),a.overlay.render()},destructor:function(){var a=this;a.calender&&(a.calender.destroy(),a.calender=null),a.overlay&&(a.overlay.destroy(),a.overlay=null)}}),a.augment(j,j.METHOD),j},{requires:["brix/core/brick","overlay","../calendar/index"]});