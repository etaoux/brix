KISSY.add("brix/gallery/colorpicker/index",function(a,b,c,d){function f(a,b,c){a=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)a.setAttribute(d,b[d]);Object.prototype.toString.call(c)!="[object Array]"&&(c=[c]);var e=0,f=c[0]&&c.length||0;for(;e<f;e++)a.appendChild(c[e]);return a}function g(){g.superclass.constructor.apply(this,arguments);var b=this,c=a.one(b.get("trigger"));if(c){var d=b.get("triggerType");a.each(d,function(a){c.on(a,function(a){a.preventDefault(),b.toggle()})})}}var e=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";return g.ATTRS={min:{value:!1},trigger:{value:!1},triggerType:{value:["click"]},align:{value:{node:!1,points:["bl","tl"],offset:[0,0]}},colorList:{value:["#d81e06","#f4ea2a","#1afa29","#1296db","#13227a","#d4237a","#ffffff","#e6e6e6","#dbdbdb","#cdcdcd","#bfbfbf","#8a8a8a","#707070","#515151","#2c2c2c","#000000","#ea986c","#eeb174","#f3ca7e","#f9f28b","#c8db8c","#aad08f","#87c38f","#83c6c2","#7dc5eb","#87a7d6","#8992c8","#a686ba","#bd8cbb","#be8dbd","#e89abe","#e8989a","#e16632","#e98f36","#efb336","#f6ef37","#afcd51","#7cba59","#36ab60","#1baba8","#17ace3","#3f81c1","#4f68b0","#594d9c","#82529d","#a4579d","#db649b","#dd6572","#d81e06","#e0620d","#ea9518","#f4ea2a","#8cbb1a","#2ba515","#0e932e","#0c9890","#1295db","#0061b2","#0061b0","#004198","#122179","#88147f","#d3227b","#d6204b"]},data:{valueFn:function(){return{colorList:this.get("colorList"),color:this.get("color"),min:this.get("min")}}},tmpl:{value:'<div class="colorpicker"><div class="colorpicker-hd"><ul>{{#colorList}}<li val="{{.}}" style="background-color:{{.}};"></li>{{/colorList}}</ul></div><div class="colorpicker-md"><i class="iconfont icon-arrow {{^min}}icon-arrow-up{{/min}}">{{#min}}&#405{{/min}}{{^min}}&#404{{/min}}</i></div><div class="colorpicker-bd {{#min}}colorpicker-bd-min{{/min}}"><div class="picker-wrapper"><div class="picker"></div><i class="iconfont icon-picker-indicator">&#470</i></div><div class="slide-wrapper"><div class="slide"></div><i class="iconfont icon-slide-indicator">&#461</i></div></div><div class="colorpicker-fd"><span class="bg" style="background-color:{{color}}"></span><input type="text" value="{{color}}"><a class="btn btn-size25 btn-confirm">\u786e\u5b9a</a></div></div>'},color:{value:"#ffffff"}},g.DOCATTACH={"":{click:function(b){var c=this,d=c.get("el"),e=a.one(b.target),f=a.one(c.get("trigger"));!d.contains(e)&&f&&e[0]!=f[0]&&c.hide()}}},g.ATTACH={".picker":{click:function(a){var b=this,c=b.pickerNode.offset(),d=a.pageX-c.left,e=a.pageY-c.top,f=b.pickerNode.width(),g=b.pickerNode.height(),h=d/f,i=(g-e)/g;b.setHsv({h:b.h,s:h,v:i})}},".slide":{click:function(a){var b=this,c=b.slideNode.offset(),d=b.slideNode.height(),e=a.pageY-c.top>=d?d-1:a.pageY-c.top,f=e/d*360;b.setHsv({h:f,s:b.s,v:b.v})}},".btn-confirm":{click:function(a){this._fireSelected()}},li:{click:function(b){var c=a.one(b.currentTarget).attr("val");this.setHex(c)}},".icon-arrow":{click:function(b){var c=this,d=c.get("el").one(".colorpicker-bd"),e=a.one(b.currentTarget);d.stop(),e.hasClass("icon-arrow-up")?(e.removeClass("icon-arrow-up"),d.css("overflow","hidden"),d.animate({height:0,marginBottom:0},.3,"easyNone",function(){e.html("&#405")})):(e.addClass("icon-arrow-up"),d.animate({height:196,marginBottom:10},.3,"easyNone",function(){e.html("&#404"),d.css("overflow","visible")}))}},input:{blur:function(b){var c=this,d=a.one(b.currentTarget).val();c.get("color")!=d&&this.setHex(d)}}},g.FIRES={selected:"selected",show:"show",hide:"hide"},g.METHOD={show:function(){var b=this;b.get("rendered")||b.render();if(b.overlay){var c=a.clone(b.get("align"));c.node||(c.node=b.get("trigger")),b.overlay.set("align",c),b.overlay.show(),b.fire(g.FIRES.show)}},hide:function(){var a=this;a.overlay&&(a.overlay.hide(),a.fire(g.FIRES.hide))},toggle:function(){var a=this;a.overlay?a.overlay.get("el").css("visibility")=="hidden"?a.show():a.hide():a.show()},hsv2rgb:function(a,b,c){var d,e,f,g,h;a=a%360/60,h=c*b,g=h*(1-Math.abs(a%2-1)),d=e=f=c-h,a=~~a,d+=[h,g,0,0,g,h][a],e+=[g,h,h,g,0,0][a],f+=[0,0,g,h,h,g][a];var i=d*255,j=e*255,k=f*255;return{r:i,g:j,b:k,hex:"#"+(16777216|k|j<<8|i<<16).toString(16).slice(1)}},rgb2hsv:function(a,b,c){if(a>1||b>1||c>1)a/=255,b/=255,c/=255;var d,e,f,g;return f=Math.max(a,b,c),g=f-Math.min(a,b,c),d=g==0?null:f==a?(b-c)/g+(b<c?6:0):f==b?(c-a)/g+2:(a-b)/g+4,d=d%6*60,e=g==0?0:g/f,{h:d,s:e,v:f}},setColor:function(a,b,c){var d=this;d.h=a.h%360,d.s=a.s,d.v=a.v;var e=d.hsv2rgb(d.h,d.s,d.v);d.slideDragNode.css({top:Math.round(d.h*d.slideNode.height()/360-5)});var f=Math.round(d.s*d.pickerNode.width()-5),g=Math.round((1-d.v)*d.pickerNode.height()-5);d.pickerDragNode.css({left:f,top:g,color:g>98?"#fff":"#000"}),d.pickerNode.css({"background-color":d.hsv2rgb(d.h,1,1).hex}),d.get("el").one(".bg").css({"background-color":e.hex}),d.set("color",e.hex),d.get("el").one("input").val(e.hex)},setHsv:function(a){this.setColor(a)},setRgb:function(a){this.setColor(this.rgb2hsv(a.r,a.g,a.b),a)},setHex:function(a){this.setColor(this.rgb2hsv(parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16)),undefined,a)}},a.extend(g,b,{initialize:function(){var a=this;this.h=0,this.s=this.v=1;var b=a.get("align");a.overlay=new c({srcNode:"#"+a.get("id"),align:b}),a.overlay.render();var g=a.get("el"),i=a.slideNode=g.one(".slide"),j=a.pickerNode=g.one(".picker");e=="SVG"?(i.append(f("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[f("defs",{},f("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[f("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),f("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),f("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),f("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),f("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),f("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),f("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),f("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),f("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),f("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})])),j.append(f("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[f("defs",{},[f("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[f("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),f("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),f("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[f("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),f("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),f("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),f("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})]))):(document.namespaces.v||document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),i.html(['<div style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill>',"</v:rect>","</div>"].join("")),j.html(['<div style="position: relative; width: 100%; height: 100%">','<v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>",'<v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t">','<v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill>',"</v:rect>","</div>"].join("")));var k=a.pickerDragNode=g.one(".icon-picker-indicator"),l=a.slideDragNode=g.one(".icon-slide-indicator"),m=new d.Draggable({node:k,cursor:"move"});m.on("drag",function(b){var c=j.offset(),d=j.width(),e=j.height(),f=b.left-c.left,g=b.top-c.top;f>d?f=d:f<0?f=0:f+=5,g>e?g=e:g<0?g=0:g+=5;var h=f/d,i=(e-g)/e;a.setHsv({h:a.h,s:h,v:i})});var n=new d.Draggable({node:l,cursor:"move"});n.on("drag",function(b){var c=i.offset(),d=i.height(),e=b.top-c.top;e+5>d?e=d-1:e<0?e=0:e+=5,h=e/a.slideNode.height()*360,a.setHsv({h:h,s:a.s,v:a.v})}),a.setHex(a.get("color"))},_fireSelected:function(){var a=this,b=a.hsv2rgb(a.h,a.s,a.v);a.overlay.hide(),a.fire(g.FIRES.selected,{hex:b.hex,hsv:{h:a.h,s:a.s,v:a.v},rgb:{r:b.r,g:b.g,b:b.b}})},destructor:function(){var a=this;a.overlay.destroy()}}),a.augment(g,g.METHOD),g},{requires:["brix/core/brick","overlay","dd"]});